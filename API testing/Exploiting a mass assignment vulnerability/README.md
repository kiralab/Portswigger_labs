## Lab Description :

![image](https://github.com/sh3bu/Portswigger_labs/assets/67383098/3ecb8c6e-4cda-4347-8943-023251558d74)

## Overview :

### Mass assignment vulnerabilities

Mass assignment (also known as auto-binding) can inadvertently create hidden parameters. It occurs when software frameworks automatically bind request parameters to fields on an internal object. Mass assignment may therefore result in the application supporting parameters that were never intended to be processed by the developer.

### Identifying hidden parameters
Since mass assignment creates parameters from object fields, you can often identify these hidden parameters by manually examining objects returned by the API.

For example, consider a PATCH /api/users/ request, which enables users to update their username and email, and includes the following JSON:

```json
{
    "username": "wiener",
    "email": "wiener@example.com",
}
```
A concurrent GET /api/users/123 request returns the following JSON:

```json
{
    "id": 123,
    "name": "John Doe",
    "email": "john@example.com",
    "isAdmin": "false"
}
```

This may indicate that the hidden id and isAdmin parameters are bound to the internal user object, alongside the updated username and email parameters.

Testing mass assignment vulnerabilities
To test whether you can modify the enumerated isAdmin parameter value, add it to the PATCH request:

```json
{
    "username": "wiener",
    "email": "wiener@example.com",
    "isAdmin": false,
}
```

In addition, send a PATCH request with an invalid isAdmin parameter value:

```json
{
    "username": "wiener",
    "email": "wiener@example.com",
    "isAdmin": "foo",
}
```

If the application behaves differently, this may suggest that the invalid value impacts the query logic, but the valid value doesn't. This may indicate that the parameter can be successfully updated by the user.

You can then send a PATCH request with the isAdmin parameter value set to true, to try and exploit the vulnerability:

```json
{
    "username": "wiener",
    "email": "wiener@example.com",
    "isAdmin": true,
}
```

If the isAdmin value in the request is bound to the user object without adequate validation and sanitization, the user wiener may be incorrectly granted admin privileges. To determine whether this is the case, browse the application as wiener to see whether you can access admin functionality.

## Solution :

Login as wiener using the provided credentials - `wiener:peter`

Add the leather jacket to cart. Now while checkout, the broswer sends the following API request.

![image](https://github.com/sh3bu/Portswigger_labs/assets/67383098/77bddf5f-5351-4aa6-a9aa-0cd19708fd06)

Since the response is in JSON format, to exploit a Mass Assignment vulnerability, we need to change the request method to JSON using  **Content-Type Converter**.

Now when I send the following JSON body with a dicount percentage, I get an error emssage.

![image](https://github.com/sh3bu/Portswigger_labs/assets/67383098/2aa05dd7-7306-4f22-b6fb-08d7ab7b8167)

But when I provide the entire JSON body which I got in the first response, the request is successfull.

![image](https://github.com/sh3bu/Portswigger_labs/assets/67383098/7b3d042e-a362-48f4-b008-aed9ab84e8af)

Now in the checkout page we can see that the discount has been applied successfully & thus the lab is solved.

![image](https://github.com/sh3bu/Portswigger_labs/assets/67383098/707b511e-7505-427d-8462-28a74d847ea2)


